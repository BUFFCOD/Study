# 28.1 Analyzing Service Configuration with ss


A network socket is a connection endpoint, consisting of an IP address followed by a port number.

Sockets also exist as UNIX sockets, which are endpoints in communtcation with services on Linux/UNIX systems.

ss is the stabdard tiik to show socket information,

ss will show all connections.

ss -tu shows connected TCP and UDP sockets.

ss -tuna adds sockets that are listening state.

ss -tln show TCP sockets that are in listening state only, without resolving host names

ss -tulpn show TCP and UDP sockets that are in listening state, along with the process ID and name of the program to which each socket belongs.


Where ss is for analyzing services on the local system, nmap can be used to analyze ports that are open on remote host.

Use nmap  <ip_address> to scan the remote host for open ports.

nmap -sn <ip_address> performs a ping scan to check if the host is up.

nmap -sV <ip_address> performs a version detection scan to determine the version of services running on open ports.


## 28.2 Managing RHEL Firewalling


The Linux kernal provides the netfilter framework to take care of firewall related network operations: 

    packet filtering, 
    network address translation (NAT), 
    port forwarding,

Netfilter forwards specific operations to kernet modules.

nftables is the framework that applies firewalling.

firewalld  is a service, managed by systemd, which RHEL use as the front-end to manage nftables.


## 28.3 Exploring firewalld Components

Firewalld is using different components to make firewalling easier

- Service: the main component contains one or more ports as well as optional kernel modules that should be loaded.
- Zone: a default configuration to which network card can be assigned to apply specific settings.
- Ports: specific ports that can be opened or closed.

additional components are available as well, but not frequently used in base firewall configuration.


## 28.4 Allowing services access

the firewall-cmd command is used to write firewall configuration.

Use the option --permanent to write to persistent (but not to the runtime).

without --permanent the changes are only applied to the runtime configuration.



A firewalld service is an XML file that contains information about  and other features that must be allowed.

Default services are in /usr/lib/firewalld/services/ directory.

Custom services can be created in /etc/firewalld/services/ directory.

# Demo: Allowing Incoming HTTP Traffic

- `systemctl status firewalld`
- `firewall-cmd --list-all`
- `firewall-cmd --get-services`
- `firewall-cmd --add-service http`
- `firewall-cmd --add-service http --permanent`


## 28.5  Allowing port access

firewalld can also give access to specific ports without using service

you should consider creating a custon service in this case anyway configurion as code is easier to manage and distribute.

user firewall-cmd --add-port 82/tcp --permanent; firewall-cmd --reload to allowd access to port 82/tcp permanently and apply the changes.



## 28.6 Exploring Advanced Firewall Use --Optional


Direct Rules allowd admins to insert hand-coded rules. 

Direct rules are processed before anything in the zones.
not recommended to use them.

Rich rules use an expressive language to create custom rules that cannot be created with basic syntax.

    logging
    rate limiting
    port forwarding
    masquerading
    man firewalld-rich-language for more information about rich rules.

    # Demo: Using Rich Rules

- `firewall-cmd --permanent --zone=public --add-rich-rule='rule family=ipv4 source address=192.168.4.220 reject'`

- `firewall-cmd --add-rich-rule='rule service name=http log limit value=3/m accept'`

- `firewall-cmd --permanent --add-rich-rule='rule protocol value=igmp accept'`
  - Protocols match entries in `/etc/protocols`

- `firewall-cmd --permanent --add-rich-rule='rule family=ipv4 source address=10.0.0.0/24 port port=7900-7905 protocol=tcp accept'`

- `firewall-cmd --permanent --zone=public --add-rich-rule='rule service name="ssh" log prefix="ssh" level="notice" limit value="2/m" accept'`
- `firewall-cmd --reload`