Linux File Ownership, Permissions, and Special Bits



------------------------------------------------------------------------

1. File Ownership Basics

Every file and directory in Linux has:

-   Owner (user)
-   Group
-   Permissions for:
    -   Owner
    -   Group
    -   Others

Permission symbols: 
- r → read
- w → write
- x → execute
- o → no permission

Example:

    -rw-r--r--

Breakdown:
- rw- → owner can read & write
- r-- → group can read
- --r → others can read

------------------------------------------------------------------------

2. Permissions on Files vs Directories

  ---------------------------------------------------------------------------
  Permission                 Files            Directories
  -------------------------- ---------------- -------------------------------
  Read (r)                   View file        List directory contents (ls)
                             contents         

  Write (w)                  Modify the file  Add, remove, or rename files
                                              inside

  Execute (x)                Run              Enter directory (cd), traverse
                             program/script   subdirs
  ---------------------------------------------------------------------------

Critical RHCSA rule

A user can delete a file even if they don’t own it as long as the
directory has:

-   write (w)
-   execute (x)

------------------------------------------------------------------------

3. Example Scenario

A root-owned file inside a user’s home:

    rootfile owned by root:root
    /home/linda is 700

Linda can delete the root-owned file because she has write+execute on
the directory.

------------------------------------------------------------------------

4. chmod: Modify Permissions

Absolute mode

    chmod 755 file
    chmod 640 file

Relative mode

    chmod +x file
    chmod g-w file
    chmod o+r file

------------------------------------------------------------------------

5. Recursive Permissions: x vs X

chmod -R x

Adds execute to everything.

chmod -R X

Command	Effect
chmod a+x	Give execute to file + dir
chmod a+X	Give execute to dir only
chmod a-x	Remove execute from file + dir
chmod -R a+x	Recursive: everything exec
chmod -R a+X	Recursive: dirs only exec
chmod -R a-x	Remove exec from everything

Adds execute only to: - directories
- executable files

Safe recursion:

    chmod -R X /path

------------------------------------------------------------------------

6. Default Permissions and umask

Defaults: - Files: 666 - Directories: 777

umask subtracts from these.

Example:

    umask 022 → files 644, directories 755
    umask 027 → files 640, directories 750

Locations: - /etc/bashrc - ~/.bashrc

------------------------------------------------------------------------

# Advanced Permissions: SGID, SUID, Sticky Bit (RHCSA Notes)

---

## 7. Shared Group Directories (SGID + Sticky Bit)

### **SGID**
Makes new files inherit the directory’s group.

```
chmod g+s /shared
```

### **Sticky Bit**
Prevents users from deleting files they don’t own.

```
chmod +t /shared
```

### **Combined**
```
chmod 2770 /shared
chmod 3770 /shared
```

---

## 8. SUID (Set User ID)

### **1. What SUID Is**
SUID lets a program run with the **file owner’s privileges**.

- Numeric: `4xxx`
- Symbolic: `u+s`

---

### **2. What SUID Does**
Normally programs run with the user’s permissions.  
With SUID, they run with the **owner’s permissions**.

#### **Example: `passwd`**
Users need to modify `/etc/shadow`, which is writable **only by root**.  
`/usr/bin/passwd` is owned by root and has SUID:

```
ls -l /usr/bin/passwd
-rwsr-xr-x 1 root root ...
```

When a user runs `passwd`, it temporarily runs as **root**.

---

### **3. How SUID Appears**
- `s` → owner execute + SUID  
- `S` → SUID set, no owner execute

Examples:
```
-rwsr-xr-x
-rwSr--r--
```

---

### **4. Set / Remove SUID**

Set:
```
chmod u+s script.sh
chmod 4755 program
```

Remove:
```
chmod u-s script.sh
chmod 0755 program
```

---

### **5. Security Notes**
- SUID can unintentionally give root privileges.
- Only keep on system programs that require it (passwd, sudo).
- Avoid setting SUID on custom scripts/binaries.

---

## 9. Sticky Bit on Directories

### **1. Notation and Values**
- Numeric: `1xxx` (e.g., `1770`)
- Symbolic: `+t`

In `ls -l`, appears in "others" execute position:

- `t` → others have execute + sticky bit  
- `T` → sticky bit + no execute  

Example:
```
drwxrwxrwt   → /tmp
```

---

### **2. Purpose**
Prevents users from deleting each other's files in shared directories.

A user may delete a file only if:

- They own the file  
- They own the directory  
- They are root  

---

### **3. Common Use Cases**

#### **1. Shared Group Directories**
Used with SGID:

```
chmod g+s,o+t /data/team
```

- SGID → group inheritance  
- Sticky Bit → prevents unauthorized deletion  

#### **2. /tmp Directory**
Globally accessible:

```
drwxrwxrwt /tmp
```

---

### **4. Set / Check Sticky Bit**

Set:
```
chmod +t /shared
chmod 1777 /shared
```

Check:
```
ls -ld /shared
```

---

### **5. Sticky Bit on Files**
Has **no meaning** on regular files.

---

## 10. SGID (Set Group ID)

### **1. SGID Notation and Values**
- Numeric: `2xxx` (e.g., `2755`)
- Symbolic: `g+s`

Examples:
```
drwxr-sr-x   → SGID + group execute
drwxr-Sr-x   → SGID, no group execute
```

---

### **2. SGID on Directories (RHCSA Focus)**

When SGID is set on a directory:

- New files inherit the directory’s group  
- Overrides user’s primary group (important in RHEL 9)

### **Example Workflow**
```
mkdir /finance
chgrp finance /finance
chmod g+s /finance
```

Check:
```
ls -ld /finance
drwxr-sr-x ...
```

Test:
```
ls -l /finance/report.txt
-rw-r--r-- 1 jade finance ...
```

All members of the group can collaborate.

---

## 11. RHCSA Key Concepts

- Directory permissions control deletion  
- Use `chmod -R X` for safe recursion  
- SGID ensures group inheritance  
- Sticky Bit protects shared directories  
- SUID = elevated privileges  
- umask affects **new** files only  
- Check permissions with:
```
ls -l
ls -ld
```

to find SUID files:
```bash
find / -perm -4000 -type f 2>/dev/null
---

**End of Notes**
