## Understanding Device Mapper Names

Device mapper is the system that the kernel uses to interface storage devices.
    uses by lvm, stratis multipath and more storage systems.

Device mapper generates non-persistent names, like /dev/dm-0, /dev/dm-1.

persistent names are provided as symlinks in /dev/mapper.
    example: /dev/mapper/my_volume_group-my_logical_volume

alternatively, use the LVM generated symbolic link 
    /dev/vgdata/lvdata


## Resizing lvm logical volume

use vgs to verify the volume group  has unused disk space.

if required, use vgextend to add one or more PVs to the VG.
    example: vgextend /dev/vgdata /dev/sdb1

    use lvextend to resize the logical volume.
    lvextend -r -L +10G /dev/vgdata/lvdata
    -r: resize the file system
    -L +10G: increase the size of the LV by 10G

    resize2fs is resize utility used to resize the file system e.g. ext4.

    xfs_growfs is the utility used to resize the xfs file system.

    shrink is possible on ext4, but not on xfs.


   **Demo: Resizing a Logical Volume** 

Create 2 partitions with a size of 1GiB each and set the lvm partition type.

vgcreate vgfiles /dev/sde1

lvcreate -l 255 -n lvfiles /dev/vgfiles

mkfs.ext4 /dev/vgfiles/lvfiles

df -h

vgs shows no available extents in the volume group.

vgextend vgfiles /dev/sde2 adds a new PV to the VG.

lvextend -r -l +50%FREE /dev/vgfiles/lvfiles is now possible.

df -h shows the newly available space in the volume.


## Reducing Volume Group Size

If a volume group is conisits of multiple PVs, a PV can be removed from the VG if the remaining PVs have sufficient free space to allocate its extents.

This procedure will not work if the remaining PVs are fully used already, (must show PFree>0 in pvs output).
    example: vgreduce /dev/vgdata /dev/sdb1

    First, you'll have to use pvmove to move used extents from the volume you want to remove to the remaining volume(s).

    Next, vgreduce can be used to complete the removal

**Demo: Removing a VG from a PV**

- Use **fdisk** to create 2 partitions with a size of 2GB each and set the type to **lvm**.
- `vgcreate vgdemo /dev/sdf1`
- `lvcreate -L 1G -n lvdemo vgdemo`  # Do NOT use all space
- `vgextend vgdemo /dev/sdf2`
- `pvs` shows all extents as available on `/dev/sdf2`.
- `lvextend -L +500M /dev/vgdemo/lvdemo /dev/sdf2` ensure that free extents are used on sdf2 by adding the device name.
- `pvs` shows used extents on `/dev/sdf2`.
- `mkfs.ext4 /dev/vgdemo/lvdemo`

- `mount /dev/vgdemo/lvdemo /mnt`
- `df -h`
- `dd if=/dev/zero of=/mnt/bigfile bs=1M count=1100`  
  ensures that data is on both PVs.
- `pvmove -v /dev/sdf2 /dev/sdf1`  
  moves all used extents from sdf2 to sdf1 (can take a while).
- `pvs` will show that `/dev/sdf2` is now unused and sdf1 has fewer available extents.
- `vgreduce vgdemo /dev/sdf2` is now allowed.
