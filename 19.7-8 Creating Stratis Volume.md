# Understanding Stratis

Stratis is adding volume management capacities as a separate layer to the XFS filesystem.

Stratis volumes always used the XFS filesystem.

stratis volume are thin provisioned by default.

volume storage is allocated from the stratis pool as needed.

Each stratis volume needs a minimum size of 4 GiB.

Because of the thin provisioning, stratis tools must be used to monitor available space.


# Demo: Creating Stratis Volumes (Concept Diagram)

            FS        FS        FS
             ↑         ↑         ↑
             |         |         |
    -----------------------------------------
    |                                       |
    |        Stratis Pool (thin provisioning)  <── stratisd
    |                                       |
    -----------------------------------------
             ↑               ↑
             |               |
          blockdev        blockdev



### Explanation (matches the drawing)

- **blockdev**  
  Physical block devices (disks or partitions) at the bottom.

- **Stratis Pool (thin provisioning)**  
  Aggregates block devices and provides thin-provisioned storage.

- **FS (filesystems)**  
  Multiple filesystems created from the same Stratis pool.

- **stratisd**  
  The Stratis daemon managing pools and filesystems.

This diagram shows how Stratis sits **between block devices and filesystems**, similar in spirit to LVM but with integrated management and thin provisioning.


To work with stratis, you'll need to install the `stratis-cli`  and `stratisd` packages if they are not already installed.

```bash
sudo dnf install stratis-cli stratisd
``` 
use the stratis command  to create pools and filesystems.

While working with stratis, use `stratis pool list` to ensure the pool has sufficient space remaining.

To mount stratis volumes:

 - Use UUID.
 - Include x-systemd.requires=stratisd.service as a mount option

# Demo: Managing Stratis Volumes

- `dnf install stratis-cli stratisd`
- `systemctl enable --now stratisd`
- `stratis pool create mypool /dev/sdb`
- `stratis pool list`
- `stratis pool add-data mypool /dev/sdc`
- `stratis blockdev list`
- `stratis fs create mypool myfs`
- `mkdir /myfs`
- `lsblk --output=UUID /dev/stratis/mypool/myfs >> /etc/fstab`
- Edit `/etc/fstab` to include:
    ```
    UUID=<UUID-from-lsblk>  /myfs  xfs  defaults,x-systemd.requires=stratisd.service  0 0
    ```
- `stratis fs list`
- `stratis pool list`
- `df -h /myfs`




## Understadind stratis Snapshots

 
A Stratis snapshot is a metadata copy that allows you to access the state of the snapshot at any time.

a snapshot is NOT a backup but can be helpful in accessing deleted files.

A snapshot is mounted by its device name not by its UUID.


# Demo: Using Stratis Snapshots

- `dd if=/dev/zero of=/myfs/bigfile bs=1M count=2000`
- `stratis pool list`
- `stratis fs list`
- `stratis fs snapshot mypool myfs myfs-snap`
- `stratis fs list`
- `rm /myfs/bigfile`
- `mkdir /myfs-snap`
- `mount /dev/stratis/mypool/myfs-snap /myfs-snap`
- `ls -l /myfs-snap/`
- `stratis fs destroy mypool myfs-snap`